<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–≤–µ–Ω–∫–æ - –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∫–∞—Ä—Ç—ã</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: var(--tg-theme-bg-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        #tilda-iframe {
            width: 100%;
            height: 100vh;
            border: none;
            overflow: hidden;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--tg-theme-bg-color, #ffffff);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.3s ease;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--tg-theme-hint-color, #999999);
            border-top: 3px solid var(--tg-theme-button-color, #007AFF);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--tg-theme-text-color, #000000);
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .loading-details {
            color: var(--tg-theme-hint-color, #666666);
            font-size: 14px;
            line-height: 1.4;
        }

        .error-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--tg-theme-bg-color, #ffffff);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            padding: 20px;
            text-align: center;
        }

        .error-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .error-title {
            color: var(--tg-theme-text-color, #000000);
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .error-description {
            color: var(--tg-theme-hint-color, #666666);
            font-size: 14px;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .error-details {
            color: var(--tg-theme-hint-color, #999999);
            font-size: 12px;
            font-family: monospace;
            background: rgba(0,0,0,0.05);
            padding: 15px;
            border-radius: 8px;
            max-width: 100%;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .debug-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 10px;
            font-family: monospace;
            z-index: 11000;
            max-width: 300px;
            max-height: 150px;
            overflow-y: auto;
        }

        .fullscreen-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 128, 0, 0.8);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 11001;
            display: none;
        }
    </style>
</head>
<body>
    <div id="fullscreen-indicator" class="fullscreen-indicator">
        üî≥ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º
    </div>

    <div id="debug-info" class="debug-info">
        <div>üîß FIXED VERSION - Working Full-Screen</div>
        <div id="debug-log"></div>
    </div>

    <div id="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
            <div class="loading-details">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</div>
        </div>
    </div>

    <div id="error-overlay" class="error-message" style="display: none;">
        <div class="error-icon">üîí</div>
        <div class="error-title">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞</div>
        <div class="error-description">–£ –≤–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —ç—Ç–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.</div>
        <div class="error-details" id="error-details"></div>
    </div>

    <iframe 
        id="tilda-iframe" 
        src="" 
        allow="payment; camera; microphone; geolocation"
        referrerpolicy="strict-origin-when-cross-origin"
        style="display: none;">
    </iframe>

    <script>
        console.log('üîß FIXED Full-Screen Mini App starting...');
        let debugInfo = [];
        let debugLogElement;
        let isFullscreenActive = false;

        function addDebugInfo(info) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = timestamp + ': ' + info;
            debugInfo.push(logEntry);
            console.log(info);

            if (!debugLogElement) {
                debugLogElement = document.getElementById('debug-log');
            }
            if (debugLogElement) {
                debugLogElement.innerHTML = debugInfo.slice(-7).join('<br>');
            }
        }

        function updateFullscreenIndicator(active) {
            const indicator = document.getElementById('fullscreen-indicator');
            if (active) {
                indicator.style.display = 'block';
                isFullscreenActive = true;
                addDebugInfo('‚úÖ –ü–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–µ–Ω');
            } else {
                indicator.style.display = 'none';
                isFullscreenActive = false;
                addDebugInfo('üì± –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º');
            }
        }

        function checkTelegramWebApp() {
            if (typeof window.Telegram === 'undefined' || !window.Telegram.WebApp) {
                addDebugInfo('‚ùå Telegram WebApp API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏', '–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç–æ —á–µ—Ä–µ–∑ Telegram', 'Telegram WebApp API –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return false;
            }
            
            addDebugInfo('‚úÖ Telegram WebApp API –Ω–∞–π–¥–µ–Ω');
            addDebugInfo('üìã –í–µ—Ä—Å–∏—è API: ' + (window.Telegram.WebApp.version || '–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'));
            addDebugInfo('üîç –î–æ—Å—Ç—É–ø–Ω—ã –º–µ—Ç–æ–¥—ã: ' + Object.keys(window.Telegram.WebApp).join(', '));
            
            return true;
        }

        function initializeTelegramWebApp() {
            addDebugInfo('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp...');
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            
            // Set theme colors
            document.documentElement.style.setProperty('--tg-theme-bg-color', window.Telegram.WebApp.themeParams.bg_color || '#ffffff');
            document.documentElement.style.setProperty('--tg-theme-text-color', window.Telegram.WebApp.themeParams.text_color || '#000000');
            document.documentElement.style.setProperty('--tg-theme-button-color', window.Telegram.WebApp.themeParams.button_color || '#007AFF');
            document.documentElement.style.setProperty('--tg-theme-hint-color', window.Telegram.WebApp.themeParams.hint_color || '#999999');
            
            addDebugInfo('üé® –¢–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
        }

        function requestFullscreenMode() {
            addDebugInfo('üì± –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞...');
            
            // Check what methods are available
            const webApp = window.Telegram.WebApp;
            
            if (typeof webApp.requestFullscreen === 'function') {
                addDebugInfo('‚úÖ requestFullscreen –¥–æ—Å—Ç—É–ø–µ–Ω');
                try {
                    webApp.requestFullscreen();
                    addDebugInfo('üì± requestFullscreen –≤—ã–∑–≤–∞–Ω');
                    updateFullscreenIndicator(true);
                    return true;
                } catch (error) {
                    addDebugInfo('‚ùå –û—à–∏–±–∫–∞ requestFullscreen: ' + error.message);
                }
            } else {
                addDebugInfo('‚ö†Ô∏è requestFullscreen –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ —ç—Ç–æ–π –≤–µ—Ä—Å–∏–∏');
            }

            // Check for isFullscreen property
            if (typeof webApp.isFullscreen !== 'undefined') {
                addDebugInfo('üìä isFullscreen: ' + webApp.isFullscreen);
                updateFullscreenIndicator(webApp.isFullscreen);
            } else {
                addDebugInfo('‚ö†Ô∏è isFullscreen –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
            }

            // Enhanced viewport control as fallback
            if (webApp.viewportHeight) {
                addDebugInfo('üìê Viewport: ' + webApp.viewportHeight + 'px');
                document.body.style.height = webApp.viewportHeight + 'px';
            }

            // Try alternative fullscreen approach
            setTimeout(function() {
                addDebugInfo('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã...');
                if (typeof webApp.requestFullscreen === 'function' && !isFullscreenActive) {
                    try {
                        webApp.requestFullscreen();
                        addDebugInfo('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ requestFullscreen');
                    } catch (error) {
                        addDebugInfo('‚ùå –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞: ' + error.message);
                    }
                }
            }, 2000);

            return false;
        }

        function setupBackButton() {
            addDebugInfo('‚¨ÖÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥"...');
            
            // Set up back button with confirmation
            window.Telegram.WebApp.BackButton.onClick(function() {
                addDebugInfo('‚¨ÖÔ∏è –ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"');
                
                // Show confirmation before closing
                window.Telegram.WebApp.showConfirm(
                    '–ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ?',
                    function(confirmed) {
                        if (confirmed) {
                            addDebugInfo('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–∫—Ä—ã—Ç–∏–µ');
                            window.Telegram.WebApp.close();
                        } else {
                            addDebugInfo('‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –∑–∞–∫—Ä—ã—Ç–∏–µ');
                        }
                    }
                );
            });
            
            // Show the back button
            window.Telegram.WebApp.BackButton.show();
            addDebugInfo('‚úÖ –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        }

        function getUserData() {
            const initData = window.Telegram.WebApp.initDataUnsafe;
            const userId = initData?.user?.id;

            addDebugInfo('üë§ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...');
            addDebugInfo('üìã InitData: ' + JSON.stringify(initData?.user || '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'));

            if (!userId) {
                addDebugInfo('‚ùå ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –Ω–∞–π–¥–µ–Ω');
                showError('–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', '–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'User ID –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ initDataUnsafe');
                return null;
            }

            addDebugInfo('‚úÖ User ID: ' + userId);
            return userId;
        }

        async function checkSubscription(userId) {
            try {
                addDebugInfo('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ' + userId);
                updateLoadingText('–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏...', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ' + userId);

                const botUrl = 'https://avencobot-production.up.railway.app';
                const apiUrl = botUrl + '/api/check_subscription/' + userId;

                addDebugInfo('üì° API –∑–∞–ø—Ä–æ—Å: ' + apiUrl);

                const controller = new AbortController();
                const timeoutId = setTimeout(function() { 
                    controller.abort(); 
                }, 15000);

                const response = await fetch(apiUrl, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                addDebugInfo('üìä –û—Ç–≤–µ—Ç API: ' + response.status + ' ' + response.statusText);

                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                }

                const data = await response.json();
                addDebugInfo('üìã –î–∞–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏: ' + JSON.stringify(data));

                if (data.success && data.active) {
                    addDebugInfo('‚úÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞, –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç');
                    loadContent();
                } else {
                    addDebugInfo('‚ùå –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞');
                    showError(
                        '–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏', 
                        '–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É',
                        'API –≤–µ—Ä–Ω—É–ª: active=' + data.active + ', success=' + data.success
                    );
                }
            } catch (error) {
                addDebugInfo('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∫–∏: ' + error.message);

                if (error.name === 'AbortError') {
                    addDebugInfo('‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞');
                }

                showError(
                    '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è', 
                    '–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.',
                    error.message
                );
            }
        }

        function loadContent() {
            addDebugInfo('üì± –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...');
            updateLoadingText('–ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...', '–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Tilda —Å—Ç—Ä–∞–Ω–∏—Ü—ã');

            const urlParams = new URLSearchParams(window.location.search);
            const originalTildaUrl = urlParams.get('url');

            addDebugInfo('üîó –ò—Å—Ö–æ–¥–Ω—ã–π URL: ' + originalTildaUrl);

            if (!originalTildaUrl) {
                addDebugInfo('‚ùå URL –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω');
                showError('–û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', '–ù–µ —É–∫–∞–∑–∞–Ω URL –∫–æ–Ω—Ç–µ–Ω—Ç–∞', '–ü–∞—Ä–∞–º–µ—Ç—Ä url –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ query string');
                return;
            }

            const proxyUrl = window.location.origin + '/proxy';
            const tildaUrl = proxyUrl + '?url=' + encodeURIComponent(originalTildaUrl);

            addDebugInfo('üåê Proxy URL: ' + tildaUrl);

            const iframe = document.getElementById('tilda-iframe');
            iframe.src = tildaUrl;
            iframe.style.display = 'block';

            const loadingTimer = setTimeout(function() {
                addDebugInfo('‚è±Ô∏è –¢–∞–π–º–∞—É—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞');
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', '–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–ª–∏—à–∫–æ–º –¥–æ–ª–≥–æ', '–ü—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º–∞—É—Ç –≤ 30 —Å–µ–∫—É–Ω–¥');
            }, 30000);

            iframe.onload = function() {
                addDebugInfo('‚úÖ Iframe –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                clearTimeout(loadingTimer);

                const loadingOverlay = document.getElementById('loading-overlay');
                loadingOverlay.style.opacity = '0';
                setTimeout(function() {
                    loadingOverlay.style.display = 'none';
                }, 300);

                // Try fullscreen again after content loads
                setTimeout(function() {
                    addDebugInfo('üîÑ –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏');
                    requestFullscreenMode();
                }, 1000);
            };

            iframe.onerror = function() {
                addDebugInfo('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ iframe');
                clearTimeout(loadingTimer);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç', 'iframe.onerror —Å—Ä–∞–±–æ—Ç–∞–ª');
            };
        }

        function updateLoadingText(text, details) {
            const loadingText = document.querySelector('.loading-text');
            const loadingDetails = document.querySelector('.loading-details');

            if (loadingText) loadingText.textContent = text;
            if (loadingDetails) loadingDetails.textContent = details || '';
        }

        function showError(title, description, technicalDetails) {
            addDebugInfo('‚ùå –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É: ' + title + ' - ' + description);

            const loadingOverlay = document.getElementById('loading-overlay');
            const errorOverlay = document.getElementById('error-overlay');
            const errorDetailsEl = document.getElementById('error-details');

            loadingOverlay.style.display = 'none';
            errorOverlay.style.display = 'flex';

            errorOverlay.querySelector('.error-title').textContent = title;
            errorOverlay.querySelector('.error-description').textContent = description;

            const debugText = technicalDetails ? 
                '–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:\n' + technicalDetails + '\n\n–û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:\n' + debugInfo.join('\n') : 
                '–û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:\n' + debugInfo.join('\n');

            errorDetailsEl.textContent = debugText;
        }

        // Monitor fullscreen changes
        function monitorFullscreenChanges() {
            // Listen for fullscreen events if available
            const webApp = window.Telegram.WebApp;
            
            if (typeof webApp.onEvent === 'function') {
                try {
                    webApp.onEvent('fullscreenChanged', function(data) {
                        addDebugInfo('üì± Fullscreen –∏–∑–º–µ–Ω–µ–Ω: ' + JSON.stringify(data));
                        updateFullscreenIndicator(data.isFullscreen);
                    });

                    webApp.onEvent('fullscreenFailed', function(data) {
                        addDebugInfo('‚ùå Fullscreen failed: ' + JSON.stringify(data));
                    });

                    webApp.onEvent('viewportChanged', function(data) {
                        addDebugInfo('üìê Viewport –∏–∑–º–µ–Ω–µ–Ω: ' + JSON.stringify(data));
                    });

                    addDebugInfo('üëÇ –°–æ–±—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã');
                } catch (error) {
                    addDebugInfo('‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–±—ã—Ç–∏–π: ' + error.message);
                }
            }

            // Check fullscreen status periodically
            setInterval(function() {
                const webApp = window.Telegram.WebApp;
                if (typeof webApp.isFullscreen !== 'undefined') {
                    const currentFullscreen = webApp.isFullscreen;
                    if (currentFullscreen !== isFullscreenActive) {
                        updateFullscreenIndicator(currentFullscreen);
                    }
                }
            }, 3000);
        }

        // Main initialization function
        function startApp() {
            if (!checkTelegramWebApp()) {
                return;
            }

            initializeTelegramWebApp();
            setupBackButton();
            monitorFullscreenChanges();
            
            // Try fullscreen mode immediately
            requestFullscreenMode();

            const userId = getUserData();
            if (!userId) {
                return;
            }

            checkSubscription(userId);

            addDebugInfo('üéØ FIXED Mini App –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ');
        }

        // Start the app when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(startApp, 100);
        });

        // Alternative start if DOMContentLoaded already fired
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', startApp);
        } else {
            setTimeout(startApp, 100);
        }
    </script>
</body>
</html>
